import{r as S,j as t,B as y,y as j,d as L,I as U,T as N,P as b}from"./index-C3qfdU6q.js";import{a as P,b as $}from"./Requests.service-kNHJ9mfG.js";import{R as Q}from"./ReqToolModal-C7zApvvS.js";const w="_Top_44ts4_1",O="_Filter_44ts4_8",V="_DateFilter_44ts4_39",k="_Table_44ts4_44",d={Top:w,Filter:O,DateFilter:V,Table:k},f=e=>{const s=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${s}-${i}-${n}`},v={isLoading:!1,error:"",ReqDetailModal:!1,RequestsData:[],selectedRequest:null,selectedFilters:[],searchValue:"",minDate:"2025-01-20",maxDate:`${f(new Date)}`,count:0,urlFilter:"page=0&size=5"},z=(e,s)=>{switch(s.type){case"GET_REQUESTS":return{...e,isLoading:!0,error:""};case"GET_REQUESTS_FAILURE":return{...e,isLoading:!1,error:s.data};case"GET_REQUESTS_SUCCESS":return{...e,isLoading:!1,error:""};case"SHOW_REQUEST_DETAILS":return{...e,ReqDetailModal:!e.ReqDetailModal};case"SELECT_REQUEST":return{...e,selectedRequest:s.data};case"UPDATE_REQUESTS":return{...e,RequestsData:s.data};case"SET_COUNT":return{...e,count:s.count};case"SET_FILTERS":return{...e,selectedFilters:s.data};case"SET_SEARCH":return{...e,searchValue:s.data};case"SET_MINDATE":return{...e,minDate:s.data};case"SET_MAXDATE":return{...e,maxDate:s.data};case"SET_URL_FILTER":return{...e,urlFilter:s.data};default:return e}},M=S.createContext(null),H=e=>s=>{const[i,n]=S.useReducer(z,v),m=()=>{n({type:"SHOW_REQUEST_DETAILS"})},T=async(a,c)=>{try{const r=await $(a,c);if(!(r.status>=200&&r.status<300))throw Error("ADD unsuccessfull");j.success(`REQUEST ${c?"APPROVED":"REJECTED"}`),E(i.urlFilter)}catch(r){j.error((r==null?void 0:r.message)||"Request was not Handled")}},h=a=>{n({type:"SET_FILTERS",data:a})},o=(a,c)=>{const r=new URLSearchParams(i.urlFilter);r.set("size",`${a}`),r.set("page",`${c}`),R(r.toString())},g=a=>{n({type:"SET_SEARCH",data:a})},x=a=>{n({type:"SET_MINDATE",data:a})},_=a=>{n({type:"SET_MAXDATE",data:a})},R=a=>{const c=new URLSearchParams(a),[r,u]=[c.get("size"),c.get("page")],l=new URLSearchParams;l.set("page",`${u}`),l.set("size",`${r}`);let D=i.selectedFilters.reduce((A,I)=>`${A}&fields=${I}`,"");l.set("startDateTime",new Date(i.minDate).toISOString()),l.set("endDateTime",new Date(i.maxDate).toISOString());const C=l.toString()+D;n({type:"SET_URL_FILTER",data:C}),E(C)},p=a=>{n({type:"SET_COUNT",count:a})},E=async a=>{try{const c=await P(a),r=c.content.map(u=>{var l;return{...u,requestDate:(l=u.requestDate)==null?void 0:l.substring(0,10),approvalStatus:u.approvalStatus==="PENDING"?t.jsxs(t.Fragment,{children:[t.jsx(y,{primary:!0,onClick:()=>T(u.requestItemId,!0),children:"APPROVE"}),t.jsx(y,{primary:!0,onClick:()=>T(u.requestItemId,!1),children:"REJECT"})]}):u.approvalStatus}});n({type:"UPDATE_REQUESTS",data:r}),p(c.page.totalElements)}catch{}},F={handleReqDetailModal:m,getData:E,setSelected:a=>{n({type:"SELECT_REQUEST",data:a})},updateUrl:R,handleFilterChange:h,handleUrlChange:o,updateSearch:g,updateMinDate:x,updateMaxDate:_,setCount:p};return t.jsx(M.Provider,{value:{...i,...F},children:t.jsx(e,{...s})})},G=({})=>{const e=S.useRef(null),{getData:s,ReqDetailModal:i,RequestsData:n,searchValue:m,selectedFilters:T,count:h,urlFilter:o,maxDate:g,minDate:x,updateUrl:_,handleUrlChange:R,handleFilterChange:p,updateSearch:E,updateMaxDate:q,updateMinDate:F}=S.useContext(M),a=[{id:"requestDate",label:"Request Date"},{id:"workerName",label:"Worker Name"},{id:"toolName",label:"Tool Name"},{id:"reqQuantity",label:"Quantity"},{id:"approvalStatus",label:"Approved Status Details"},{id:"returnStatus",label:"Return Status Details"}],c=()=>{_(o)},r=l=>{const D=l.target.value;F(D)},u=l=>{const D=l.target.value;q(D)};return S.useEffect(()=>{s(o)},[]),t.jsxs(t.Fragment,{children:[t.jsx("div",{className:d.Top,children:t.jsx("div",{children:t.jsxs("div",{className:d.Filter,children:[t.jsx("label",{children:t.jsx(L,{selectedFilters:T,handleFilter:p,availFilters:["name","email"],getData:s,url:o})}),t.jsx(U,{type:"text",placeholder:"search",ref:e,defaultValue:m,onChange:l=>E(l.target.value)}),t.jsxs("div",{className:d.DateFilter,children:[t.jsx(U,{placeholder:"MinDate",type:"date",min:"2025-01-20",max:g,onChange:r,className:d.Price}),t.jsx(U,{placeholder:"MaxDate",type:"date",min:x,max:f(new Date),onChange:u,className:d.Price})]}),t.jsx(y,{primary:!0,onClick:c,children:"Filter"})]})})}),t.jsx("div",{className:d.Table,children:t.jsx(N,{tableData:n,columnData:a})}),t.jsx(b,{count:h,setUrl:R,url:o,getData:s}),i&&t.jsx(Q,{})]})},X=H(G);export{X as default};
