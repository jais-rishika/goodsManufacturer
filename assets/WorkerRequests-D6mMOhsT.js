import{r as d,j as e,B as g,y as x,M as W,I as C,i as P,d as O,T as Q,P as $}from"./index-BWAck-FT.js";import{c as v,d as z,r as V}from"./Requests.service-B3YUrYuM.js";import{c as K}from"./worker.service-CmeRnpdr.js";const H="_Top_golds_1",G="_Filter_golds_8",B="_workerName_golds_34",J="_DateFilter_golds_38",X="_Table_golds_43",Y="_Modal_golds_47",i={Top:H,Filter:G,workerName:B,DateFilter:J,Table:X,Modal:Y},w=r=>{const t=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0");return`${t}-${c}-${n}`},Z={returnModal:!1,workerDetailModal:!1,WorkerRequestsData:[],selectedRequest:null,selectedWorker:null,selectedFilters:[],searchValue:"",minDate:"2025-01-20",maxDate:`${w(new Date)}`,count:0,urlFilter:"page=0&size=5"},ee=(r,t)=>{switch(t.type){case"SHOW_RETURN_MODAL":return{...r,returnModal:!r.returnModal};case"WORKER_DETAIL_MODAL":return{...r,workerDetailModal:!r.workerDetailModal};case"UPDATE_WORKERS_REQUESTS":return{...r,WorkerRequestsData:t.data};case"SELECT_REQUEST":return{...r,selectedRequest:t.data};case"SELECT_WORKER":return{...r,selectedWorker:t.data};case"SET_COUNT":return{...r,count:t.count};case"SET_FILTERS":return{...r,selectedFilters:t.data};case"SET_SEARCH":return{...r,searchValue:t.data};case"SET_MINDATE":return{...r,minDate:t.data};case"SET_MAXDATE":return{...r,maxDate:t.data};case"SET_URL_FILTER":return{...r,urlFilter:t.data};default:return r}},k=d.createContext(null),te=r=>t=>{const[c,n]=d.useReducer(ee,Z),h=a=>{console.log("here1"),M(a),m()},m=()=>{console.log("here2"),n({type:"SHOW_RETURN_MODAL"})},R=async a=>{try{const s=await K(a);console.log(s),N(s.data),D()}catch{x.error("Could not get Worker Detail")}},D=()=>{n({type:"WORKER_DETAIL_MODAL"})},E=a=>{n({type:"SET_FILTERS",data:a})},p=(a,s)=>{const l=new URLSearchParams(c.urlFilter);l.set("size",`${a}`),l.set("page",`${s}`),_(l.toString())},I=a=>{console.log(a),n({type:"SET_SEARCH",data:a})},F=a=>{n({type:"SET_MINDATE",data:a})},U=a=>{n({type:"SET_MAXDATE",data:a})},_=a=>{const s=new URLSearchParams(a),[l,o]=[s.get("size"),s.get("page")],u=new URLSearchParams;u.set("page",`${o}`),u.set("size",`${l}`),u.set("search",c.searchValue);let j=c.selectedFilters.reduce((L,b)=>`${L}&fields=${b}`,"");u.set("startDateTime",new Date(c.minDate).toISOString()),u.set("endDateTime",new Date(c.maxDate).toISOString());const q=u.toString()+j;n({type:"SET_URL_FILTER",data:q}),T(q)},y=a=>{n({type:"SET_COUNT",count:a})},S=async(a,s)=>{try{const l=await z(a,s);if(!(l.status>=200&&l.status<300))throw Error("ADD unsuccessfull");x.success(`REQUEST ${s?"APPROVED":"REJECTED"}`),T(c.urlFilter)}catch(l){x.error((l==null?void 0:l.message)||"Request was not Handled")}},T=async a=>{try{const s=await v(a),l=s.content.map(o=>{var u,j;return{...o,workerName:e.jsx("p",{className:i.workerName,onClick:()=>R(o.workerId),children:o.workerName}),returnDate:o.returnDate?(u=o.returnDate)==null?void 0:u.substring(0,10):"No Return Date",requestDate:(j=o.requestDate)==null?void 0:j.substring(0,10),approvalStatus:o.toolCategory==="SPECIAL"&&o.approvalStatus==="PENDING"?"Waiting for Approval(Special Tool)":o.approvalStatus==="PENDING"?e.jsxs(e.Fragment,{children:[e.jsx(g,{primary:!0,onClick:()=>S(o.requestItemId,!0),children:"APPROVE"}),e.jsx(g,{primary:!0,onClick:()=>S(o.requestItemId,!1),children:"REJECT"})]}):o.approvalStatus,returnStatus:o.isPerishable?"Return Not Required":o.returnStatus==="PENDING"?e.jsx(g,{primary:!0,onClick:()=>h(o),children:"RETURN"}):"RETURNED"}});n({type:"UPDATE_WORKERS_REQUESTS",data:l}),y(s.page.totalElements)}catch{x.error("Sorry Could not fetch Workers Request")}},M=a=>{n({type:"SELECT_REQUEST",data:a})},N=a=>{n({type:"SELECT_WORKER",data:a})},f={handleReturnModal:m,handleWorkerDetailModal:D,getData:T,setSelected:M,selectWorker:N,updateUrl:_,handleFilterChange:E,handleUrlChange:p,updateSearch:I,updateMinDate:F,updateMaxDate:U,setCount:y};return e.jsx(k.Provider,{value:{...c,...f},children:e.jsx(r,{...t})})},ae=()=>{const{handleReturnModal:r,selectedRequest:t}=d.useContext(k),c=d.useRef(null),n=async()=>{var m,R;const h=(m=c.current)==null?void 0:m.value;if(h){if(+h>t.reqQuantity)return alert("Return Qty can be more than Allocated");if(+h<1)return alert("Returned Quantity can't be less than 0")}try{const D={requestItemId:t.requestItemId,returnQuantity:(R=c.current)==null?void 0:R.value,actualReturnDate:new Date},E=await V(D);if(!(E.status>=200&&E.status<300))throw Error("RETURN FAILED");x.success("Tools Returned")}catch{x.error("Tools Return Failed")}finally{r()}};return e.jsx(W,{setShowModal:r,children:e.jsxs("div",{className:i.Modal,children:[e.jsx("h2",{children:"Return Item"}),e.jsxs("p",{children:["Total item quantity alloted to worker: ",t==null?void 0:t.reqQuantity]}),e.jsx(C,{placeholder:"returned item Quantity",ref:c,type:"number",min:0,max:t==null?void 0:t.reqQuantity}),e.jsx(g,{primary:!0,onClick:n,children:"RETURN"})]})})},re="_Modal_lizxo_1",se="_ImgContainer_lizxo_9",le="_Detail_lizxo_18",A={Modal:re,ImgContainer:se,Detail:le},ne=()=>{const{handleWorkerDetailModal:r,selectedWorker:t}=d.useContext(k);return e.jsx(W,{setShowModal:r,children:e.jsxs("div",{className:A.Modal,children:[e.jsxs("div",{className:A.Detail,children:[e.jsxs("p",{children:["NAME: ",e.jsx("span",{children:t==null?void 0:t.workerName})]}),e.jsxs("p",{children:["EMAIL: ",e.jsx("span",{children:t==null?void 0:t.workerEmail})]})]}),e.jsx("div",{className:A.ImgContainer,children:e.jsx("img",{src:(t==null?void 0:t.workerImageUrl)||P})})]})})},oe=({})=>{const r=d.useRef(null),{getData:t,WorkerRequestsData:c,returnModal:n,workerDetailModal:h,updateUrl:m,searchValue:R,selectedFilters:D,count:E,urlFilter:p,handleUrlChange:I,handleFilterChange:F,updateSearch:U,updateMaxDate:_,updateMinDate:y,maxDate:S,minDate:T}=d.useContext(k),M=[{id:"requestDate",label:"Request Date"},{id:"workerName",label:"Worker Name"},{id:"toolName",label:"Tool Name"},{id:"reqQuantity",label:"Quantity"},{id:"approvalStatus",label:"Approved Status Details"},{id:"returnDate",label:"Return Date"},{id:"returnStatus",label:"Return Status Details"}],N=()=>{m(p)},f=s=>{const l=s.target.value;y(l)},a=s=>{const l=s.target.value;_(l)};return d.useEffect(()=>{t(p)},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:i.Top,children:e.jsx("div",{children:e.jsxs("div",{className:i.Filter,children:[e.jsx("label",{children:e.jsx(O,{selectedFilters:D,handleFilter:F,availFilters:["workerName","toolName"],getData:t,url:p})}),e.jsx(C,{type:"text",placeholder:"search",ref:r,defaultValue:R,onChange:s=>U(s.target.value)}),e.jsxs("div",{className:i.DateFilter,children:[e.jsx(C,{placeholder:"MinDate",type:"date",min:"2025-01-20",max:S,onChange:f,className:i.Price}),e.jsx(C,{placeholder:"MaxDate",type:"date",min:T,max:w(new Date),onChange:a,className:i.Price})]}),e.jsx(g,{primary:!0,onClick:N,children:"Filter"})]})})}),e.jsx("div",{className:i.Table,children:e.jsx(Q,{tableData:c,columnData:M})}),e.jsx($,{count:E,setUrl:I,url:p,getData:t}),n&&e.jsx(ae,{}),h&&e.jsx(ne,{})]})},de=te(oe);export{de as default};
