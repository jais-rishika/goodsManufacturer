import{z as S,r as u,j as e,B as f,h as G,k as O,a as U,b as I,M as b,I as p,S as N,y as A,d as z,T as B,P as H}from"./index-BWAck-FT.js";import{g as q,a as W,b as Y,d as J,e as K}from"./Facility.service-DIHluSvV.js";const Q="_Top_1kw61_1",X="_Filter_1kw61_8",Z="_Table_1kw61_36",L={Top:Q,Filter:X,Table:Z},ee="_Form_1dq9l_1",w={Form:ee},$=S.object({name:S.string({invalid_type_error:"Name must be String"}).min(2,{message:"name should contain atleast 2 chars"}),address:S.string({invalid_type_error:"address must be String"}).min(5,{message:"address should contain atleast 2 chars"}),facilityManagerEmail:S.string().optional()}),ae={isLoading:!1,error:"",addModal:!1,editModal:!1,deleteModal:!1,selected:null,facilityTableData:[],availFields:[],selectedManager:null,selectedFilters:[],searchValue:"",count:0,urlFilter:"page=0&size=5"},te=(a,s)=>{switch(s.type){case"ADD_MODAL":return{...a,addModal:s.status};case"EDIT_MODAL":return{...a,editModal:s.status};case"DELETE_MODAL":return{...a,deleteModal:s.status};case"GET_DATA":return{...a,isLoading:!0,error:""};case"GET_DATA_FAILED":return{...a,isLoading:!1,error:s.error};case"GET_DATA_SUCCESS":return{...a,isLoading:!1,facilityTableData:s.data};case"SELECT":return{...a,selected:s.selected};case"SET_AVAIL_FIELDS":return{...a,availFields:s.data};case"SET_MANAGER":return{...a,selectedManager:s.data};case"SET_COUNT":return{...a,count:s.count};case"SET_FILTERS":return{...a,selectedFilters:s.data};case"SET_SEARCH":return{...a,searchValue:s.data};case"SET_URL_FILTER":return{...a,urlFilter:s.data};default:return{...a}}},j=u.createContext(null),se=a=>s=>{const[t,r]=u.useReducer(te,ae),c=()=>{r({type:"ADD_MODAL",status:!t.addModal})},d=()=>{r({type:"EDIT_MODAL",status:!t.editModal})},y=()=>{r({type:"DELETE_MODAL",status:!t.deleteModal})},h=l=>{r({type:"SELECT",selected:l})},F=async l=>{const n=await q(l);console.log(n),r({type:"SET_AVAIL_FIELDS",data:n.data})},o=async l=>{r({type:"SET_MANAGER",data:l})},i=(l,n)=>{r({type:"SET_FILTERS",data:l});const g=new URLSearchParams(n),[T,V]=[g.get("size"),g.get("page")],D=new URLSearchParams;D.set("page",`${V}`),D.set("size",`${T}`),t.searchValue&&D.set("search",t.searchValue||"");const k=l.reduce((P,v)=>`${P}&fields=${v}`,"");M(D.toString()+k)},E=(l,n)=>{const g=new URLSearchParams(t.urlFilter);g.set("size",`${l}`),g.set("page",`${n}`),i(t.selectedFilters,g.toString())},m=l=>{r({type:"SET_SEARCH",data:l});const n=new URLSearchParams(t.urlFilter);n.set("search",l),i(t.selectedFilters,n.toString())},M=l=>{r({type:"SET_URL_FILTER",data:l})},x=l=>{r({type:"SET_COUNT",count:l})},_=l=>e.jsxs(e.Fragment,{children:[e.jsx(f,{primary:!0,onClick:()=>{h(l),d()},children:e.jsx(G,{})}),e.jsx(f,{danger:!0,onClick:()=>{h(l),y()},children:e.jsx(O,{})})]}),C={handleAddModal:c,handleEditModal:d,handleDeleteModal:y,handleSelect:h,getData:async l=>{try{r({type:"GET_DATA"});const n=await W(l);x(n.page.totalElements);const g=n.content.map(T=>({name:T.name,address:T.address,facilityManagerEmail:T.facilityManagerEmail,action:_(T)}));r({type:"GET_DATA_SUCCESS",data:g})}catch{r({type:"GET_DATA_FAILED",error:"Could not Fetch the Facilities"})}},setAvailFields:F,updateManager:o,handleFilterChange:i,handleUrlChange:E,updateSearch:m,setCount:x};return e.jsx(j.Provider,{value:{...t,...C},children:e.jsx(a,{...s})})},le=({})=>{var E;const{availFields:a,setAvailFields:s,handleAddModal:t,getData:r,urlFilter:c,selectedManager:d,updateManager:y}=u.useContext(j),{register:h,handleSubmit:F,formState:o}=U({resolver:I($)}),i=async m=>{d||alert("ADD Facility Manager"),m.facilityManagerEmail=d;try{await Y(m),t(),r(c),A.success("Facility Added ")}catch{A.error("Sorry!! Facility Could not be Added")}};return u.useEffect(()=>{s("")},[]),e.jsx(b,{setShowModal:t,children:e.jsxs("form",{onSubmit:F(i),className:w.Form,children:[e.jsx("h2",{children:"Add WorkPlace"}),e.jsx(p,{placeholder:"Enter Facility Name",...h("name")}),!!o.errors.name&&e.jsx("small",{children:o.errors.name.message}),e.jsx(N,{setFieldValue:y,availFields:a,setAvailFields:s,toSearch:"Email"}),!!o.errors.facilityManagerEmail&&e.jsx("small",{children:(E=o.errors.facilityManagerEmail)==null?void 0:E.message}),e.jsx(f,{type:"submit",children:"Add"})]})})},re=({})=>{const{handleDeleteModal:a,getData:s,selected:t,urlFilter:r}=u.useContext(j),c=async()=>{try{await J(t.id),s(r),A.success("Facilty Manager Deleted Successfully")}catch{A.error("Facilty Manager Deletion Failed")}finally{a()}};return e.jsx(b,{setShowModal:a,children:e.jsxs("div",{className:w.DeleteContainer,children:[e.jsx("h2",{children:"Delete Facility Manager"}),e.jsx("h5",{children:"Are You sure you want to delete this FacilityManager?"}),e.jsx(f,{danger:!0,onClick:c,children:"DELETE"})]})})},ie=({})=>{var m,M;const{handleEditModal:a,getData:s,selected:t,availFields:r,setAvailFields:c,urlFilter:d,selectedManager:y,updateManager:h}=u.useContext(j),{register:F,handleSubmit:o,formState:i}=U({defaultValues:{name:`${t.name}`,address:`${t.address}`,facilityManagerEmail:`${t.facilityManagerEmail}`},resolver:I($)}),E=async x=>{x.facilityManagerEmail=y||(t==null?void 0:t.facilityManagerEmail);try{await K({...x},t.id),s(d),A.success("Facility  Edited ")}catch{A.error("Sorry!! Facility  Could not be Edited")}finally{a()}};return u.useEffect(()=>{c("")},[]),e.jsx(b,{setShowModal:a,children:e.jsxs("form",{onSubmit:o(E),className:w.Form,children:[e.jsx("h2",{children:"Edit Facility"}),e.jsx(p,{placeholder:"Enter Facility Name",...F("name")}),!!i.errors.name&&e.jsx("small",{children:i.errors.name.message}),e.jsx(p,{placeholder:"Enter Facility Location",...F("address")}),!!i.errors.name&&e.jsx("small",{children:(m=i.errors.address)==null?void 0:m.message}),e.jsx(N,{setFieldValue:h,availFields:r,setAvailFields:c,toSearch:"Email",selectedField:t.facilityManagerEmail}),!!i.errors.facilityManagerEmail&&e.jsx("small",{children:(M=i.errors.facilityManagerEmail)==null?void 0:M.message}),e.jsx(f,{type:"submit",children:"Edit"})]})})},ne=({})=>{const{getData:a,handleAddModal:s,addModal:t,deleteModal:r,editModal:c,facilityTableData:d,selected:y,searchValue:h,selectedFilters:F,count:o,urlFilter:i,handleUrlChange:E,handleFilterChange:m,updateSearch:M}=u.useContext(j),x=u.useRef(null),_=[{id:"name",label:"Facility Name"},{id:"address",label:"Facility Address"},{id:"facilityManagerEmail",label:"Facility Manager Email"},{id:"action",label:"Actions"}],R=()=>{a(i)};return u.useEffect(()=>{a(i)},[]),e.jsxs("div",{children:[e.jsxs("div",{className:L.Top,children:[e.jsx("div",{children:e.jsxs("div",{className:L.Filter,children:[e.jsx("label",{children:e.jsx(z,{selectedFilters:F,handleFilter:m,availFilters:["name","address"],getData:a,url:i})}),e.jsx(p,{type:"text",placeholder:"search",ref:x,defaultValue:h,onChange:C=>M(C.target.value)}),e.jsx(f,{primary:!0,onClick:R,children:"Filter"})]})}),e.jsx(f,{primary:!0,onClick:s,children:"Add Facility"})]}),e.jsx("div",{className:L.Table,children:e.jsx(B,{tableData:d,columnData:_})}),e.jsx(H,{count:o,url:i,setUrl:E,getData:a}),t&&e.jsx(le,{}),y&&c&&e.jsx(ie,{}),r&&e.jsx(re,{})]})},oe=se(ne);export{oe as default};
